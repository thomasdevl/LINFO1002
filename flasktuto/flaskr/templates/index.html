{% extends "base.html" %}
{% block content %}
<!-- Page content -->
    <body>

        <div class="info"> 
            <p>Contrary to popular belief, Lorem Ipsum is not simply random text. It has roots in a piece of classical Latin literature from 45 BC, making it over 2000 years old. Richard McClintock, a Latin professor at Hampden-Sydney College in Virginia, looked up one of the more obscure Latin words, consectetur, from a Lorem Ipsum passage, and going through the cites of the word in classical literature, discovered the undoubtable source. Lorem Ipsum comes from sections 1.10.32 and 1.10.33 of "de Finibus Bonorum et Malorum" (The Extremes of Good and Evil) by Cicero, written in 45 BC. This book is a treatise on the theory of ethics, very popular during the Renaissance. The first line of Lorem Ipsum, "Lorem ipsum dolor sit amet..", comes from a line in section 1.10.32.
        
            The standard chunk of Lorem Ipsum used since the 1500s is reproduced below for those interested. Sections 1.10.32 and 1.10.33 from "de Finibus Bonorum et Malorum" by Cicero are also reproduced in their exact original form, accompanied by English versions from the 1914 translation by H. Rackham</p>
        </div>
        
        
    <h2> <center><u>________________________________________________________________________</u> </center></h2>
    <br>

    <div class="cadre">

    <div class="date">

      
        <label for="start">Start date:</label>

        <input type="date" id="start" name="trip-start"
                    value="2018-07-22"
                    min="1990-10-03" max="2020-12-19">   

        <label for="start">End date:</label>

        <input type="date" id="stop" name="trip-stop"
                    value="2018-07-22"
                    min="1990-10-03" max="2020-12-19">   


    </div>
    </div>
<br>
<br>

    <div class = graph_but>

        <button class= "bout" onclick="Graphnaissance()">Graph Naissance </button>
        <button class= "bout">Graph 2 </button>
        <button class= "bout">Graph 3 </button>

    </div>
        <br>

        <br>
    <div class = "graph"> 

        <br>
        <button onclick="ShowSettings()">Settings </button>

        <div class="flex" id="Cheese">
            <div class="qcm">
                <h1>Type :</h1>

                    <label class="Qcm">Bar
                    <input type="radio" checked="checked" name="radio" onclick="updatetype_graph('bar')">
                    <span class="checkmark"></span>
                    </label>

                    <label class="Qcm">PolarArea
                    <input type="radio" name="radio" onclick="updatetype_graph('polarArea')">
                    <span class="checkmark"></span>
                    </label>

                    <label class="Qcm">Pie
                    <input type="radio" name="radio" onclick="updatetype_graph('pie')">
                    <span class="checkmark"></span>
                    </label>

                    <label class="Qcm">Radar
                    <input type="radio" name="radio" onclick="updatetype_graph('radar')">
                    <span class="checkmark"></span>
                    </label>

                    <label class="Qcm">Line
                    <input type="radio" name="radio" onclick="updatetype_graph('line')">
                    <span class="checkmark"></span>
                    </label>
            </div>

            <div class="color">
                <h1>Palette de couleur :</h1>

                    <label class="Qcm">Vintage
                    <input type="radio" checked="checked" name="radio" onclick="updatecolor(['rgb(98, 131, 149)','rgb(150, 137, 123)','rgb(223, 213, 165)','rgb(219, 173, 106)','rgb(207, 153, 95)'])">
                    <span class="checkmark"></span>
                    </label>

                    <label class="Qcm">Océan
                    <input type="radio" name="radio" onclick="updatecolor(['rgb(126, 46, 132)','rgb(0, 78, 152)','rgb(58, 175, 185)','rgb(100, 233, 238)','rgb(151, 200, 235)'])">
                    <span class="checkmark"></span>
                    </label>
                    
                    <label class="Qcm">Chaleur
                    <input type="radio" name="radio" onclick="updatecolor(['rgb(191, 25, 13)','rgb(255, 71, 71)','rgb(249, 198, 57)','rgb(184, 0, 70)','rgb(239, 131, 84)'])">
                    <span class="checkmark"></span>
                    </label>

                    <label class="Qcm">Bonbon
                    <input type="radio" name="radio" onclick="updatecolor(['rgb(126, 46, 132)','rgb(209, 64, 129)','rgb(239, 121, 138)','rgb(210, 214, 239)','rgb(191, 25, 13)'])">
                    <span class="checkmark"></span>
                    </label>
            </div>
        </div>
        <script>
            //permet au bouton de cacher les paramètres
            function ShowSettings() {
                var x = document.getElementById("Cheese");
                if (x.style.display === "flex") {
                    x.style.display = "none";
                } else {
                    x.style.display = "flex";
                }
            }
            </script>

        <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.3/Chart.bundle.min.js"></script>
        
        <canvas id="graphique" width="100px" height="100px"></canvas>
        <script>

            //donné venant de la bd
            const fam = '{{ graph_data.famille |tojson}}'; 
            const fam_id = '{{ graph_data.famille_id |tojson}}'; 
            const fam_names = '{{ graph_data.famille_names |tojson }}'; 
            const fam_en_vie = '{{ graph_data.famille_en_vie }}';
            const naiss = '{{ graph_data.naissance }}';
            const naiss_dico = '{{ graph_data.naissance_dico }}';
            
            //modif les valeurs en list et les convet en int si nécessaire
            var fam_id_lst_int = fam_id.replace('[', '').replace(']', '').split(",").map(Number);
            var fam_names_lst = fam_names.replace('[', '').replace(']', '').split(",")

            var naiss_lst = naiss.replace('[', '').replace(']', '').split(",")
            let naiss_d_lst =  naiss_dico.replaceAll('{', '').replaceAll('}', '').replaceAll('(&#39;', '').replaceAll('&#39;,):', '').replaceAll(',', '').split(" ")


            //dictionnaire avec chaque date et le nombre de naissance 
            let naiss_dic = {}; 
                for (let i=0; i< naiss_d_lst.length; i=i+2 ) {
                    naiss_dic[naiss_d_lst[i]] = naiss_d_lst[i+1];
            }


            var date_start = document.getElementById("start");
            var date_stop = document.getElementById("stop");

            //console.log(date_start)
            //console.log(date_stop)

            var key = '01/01/1999'


            console.log(Object.keys(naiss_dic));
            console.log('01/01/1999' in naiss_dic);
            console.log(naiss_dic)

            var data =  [12, 19, 3, 5, 2, 3,50,20];
            var labels = ['Jean', 'Martine', 'Michel', 'Jules', 'Louise', 'Dominique','thomas','JEAN'];

            //var data = fam_id_lst_int
            //var labels = fam_names_lst


            //console.log(fam_names[0])
            //console.log(fam_id_lst_int);
            //console.log(fam_id_lst_int[0]);
            //console.log(Array.isArray(fam_id_lst_int)); 

            //console.log(fam_names)

            //repète les couleurs pour la palette 
            var colors = ['rgb(98, 131, 149)','rgb(150, 137, 123)','rgb(223, 213, 165)','rgb(219, 173, 106)','rgb(207, 153, 95)'];
            window.onload = function pallette() {
            var bgColors = [];
            for (var i = 0; i < data.length; i++) {
                bgColors.push(colors[i % colors.length]);  
            }

            const ctx = document.getElementById('graphique').getContext('2d');
            window.myChart = new Chart(ctx, {
            type: ['bar'],   // le type du graphique
            data: {        // les données
                labels: labels,
                datasets: [{
                            backgroundColor: bgColors,
                            label: 'votes',
                            fill: false,
                            data: data
                        }]
                }, 
            options :{
                scales: {
                    xAxes: [{
                        gridLines: {
                            drawOnChartArea: true
                            }
                            }],
                    yAxes: [{
                        gridLines: {
                            drawOnChartArea: true
                            }
                        }]
                    }   
                }
            }
            );
            };

            //creer le graph avec le nombre de naissance par jour en fct de la date
            function Graphnaissance(){

                //recup les dates input par le user
                var date_start = document.getElementById("start").value;
                var date_stop = document.getElementById("stop").value;

                //console.log(date_start)
                //console.log(date_stop)

                //creer une liste avec tous les jours entre les deux dates
                var getDaysArray = function(start, end) {
                    for(var arr=[],dt=new Date(start); dt<=new Date(end); dt.setDate(dt.getDate()+1)){
                    arr.push(new Date(dt));
                    }
                return arr;
                };

                var date_lst = getDaysArray(new Date(date_start),new Date(date_stop));
                //console.log(date_lst);

                
                //reg dans le dico si c'est dedans et creer une nouvelle liste avec le nombre de naissance par jour 
                
                //naiss_dic
                var nmb_naissance =[];
                var jour = [];

                for (var i = 0; i < date_lst.length; i++) {

                    //changer les dates pour être comme dans le dico 
                    var month = date_lst[i].getUTCMonth() + 1; //months from 1-12
                    var day = date_lst[i].getUTCDate();
                    var year = date_lst[i].getUTCFullYear();

                    newdate = day + "/" + month + "/" + year;

                    if (newdate in naiss_dic){
                        nmb_naissance.push(naiss_dic[newdate])
                        jour.push(newdate)
                    }else{
                        nmb_naissance.push(0)
                        jour.push(newdate)
                    }
                }

                //comparer les dates avec les familles choisient et baisser de 1 la valeur dans la lst nmb_naissance
                // aller sur chaque element de jour et si pas dans la liste et pas a zero descendre de 1

                
                //mettre a jour le graph avec les 2 listes
                myChart.data.labels = jour;
                myChart.data.datasets[0].data = nmb_naissance;
                myChart.update();
                
            }

            // met a jour les couleurs du graph
            function updatecolor(color){
                var col = []

                for (var i = 0; i < myChart.data.datasets[0].data.length; i++) {
                    col.push(color[i % color.length]);  
                }
            
                myChart.data.datasets[0].backgroundColor = col;
                myChart.update();
            }
            
            // met a jour le type de graph
            function updatetype_graph(type){


                myChart.config.type = type;  

                if(type == 'polarArea' || type == 'pie' || type == 'radar'){
                    myChart.options.scales.xAxes[0].gridLines.color = "#FFFFFF";
                    myChart.options.scales.yAxes[0].gridLines.color = "#FFFFFF";
                    myChart.options.scales.xAxes[0].ticks.display = false;
                    myChart.options.scales.yAxes[0].ticks.display = false;
                }

                if(type == 'bar' || type == 'line'){
                    myChart.options.scales.xAxes[0].ticks.display = true;
                    myChart.options.scales.yAxes[0].ticks.display = true;
                    myChart.options.scales.xAxes[0].gridLines.color = "rgb(231,233,237)";
                    myChart.options.scales.yAxes[0].gridLines.color = "rgb(231,233,237)";
                }

                myChart.update();
            }
        </script> 

    </div>
       
    
    </body>
{% endblock %}
